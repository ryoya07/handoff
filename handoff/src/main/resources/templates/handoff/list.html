<!doctype html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>引き継ぎ一覧</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: #0f1115;
      font-family: "Meiryo", "メイリオ", sans-serif;
    }

    .navbar {
      background: #151922;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }

    .card {
      background: #151922;
      border: 1px solid rgba(255,255,255,.08);
    }

    .table-dark { --bs-table-bg: #151922; }

    .table-hover tbody tr:hover {
      background-color: rgba(255,255,255,.05);
    }

    /* 行の余白を少し広げる */
    .table td, .table th {
      padding-top: 1rem;
      padding-bottom: 1rem;
    }

    .text-muted {
      color: rgba(255,255,255,.6) !important;
    }

    .mono {
      font-variant-numeric: tabular-nums;
    }

    .badge-read {
      background-color: #6c757d;
      color: white;
      padding: .5em .8em;
    }

    .badge-unread {
      background-color: #198754;
      color: white;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
  </style>
</head>

<body class="text-light">

<div th:replace="fragments/header :: header(false, false, true, true)"></div>

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10 col-xl-9">

      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0">引き継ぎ一覧</h1>

        <a class="btn btn-primary btn-lg rounded-pill shadow-sm"
           th:href="@{/handoff/new}">
          ＋ 新規作成
        </a>
      </div>

      <div class="card rounded-4 shadow-sm">
        <div class="card-body p-4">

          <div class="table-responsive">
            <table class="table table-dark table-hover align-middle mb-0 text-center">

              <thead>
                <tr>
                  <th style="width: 80px;"></th>
                  <th style="width:300px;" class="text-start;">タイトル / 内容</th>
                  <th style="width:160px;" class="text-center">作成者</th>
                  <th style="width:190px;" class="text-center">作成日時</th>
                  <th style="width:140px; white-space: nowrap;" class="text-center">ステータス</th>
                  <th style="width:120px;"></th>
                </tr>
              </thead>

              <tbody>
                <tr th:each="handoff : ${handoffs}">

                  <!-- 編集 -->
				  <td>
				    <a th:if="${handoff.createdById == loginUserId}"
				       th:href="@{|/handoff/${handoff.id}/edit|}"
				       class="btn btn-sm btn-outline-warning">
				      編集
				    </a>

				    <button th:unless="${handoff.createdById == loginUserId}"
				            type="button"
				            class="btn btn-sm btn-outline-secondary"
				            data-bs-toggle="modal"
				            data-bs-target="#forbiddenModal">
				      編集
				    </button>
				  </td>

                  <!-- タイトル / 内容（左寄せ） -->
				  <td class="text-start">
				    <a th:href="@{|/handoff/${handoff.id}|}"
				       class="text-decoration-none text-light">
				      <div class="fw-semibold" th:text="${handoff.title}">タイトル</div>
				      <div class="text-muted small"
				           th:text="${#strings.abbreviate(handoff.content, 80)}">
				        内容
				      </div>
				    </a>
				  </td>

                  <!-- 作成者 -->
				  <td th:text="|${handoff.createdByName} さん|">作成者</td>

                  <!-- 日時 -->
                  <td class="mono"
                      th:text="${#temporals.format(handoff.createdAt, 'yyyy-MM-dd HH:mm')}">
                    2026-02-17 14:00
                  </td>

                  <!-- 状態 -->
                  <td>
                    <span th:if="${handoff.readFlag == 1}"
                          class="badge badge-read rounded-pill">
                      既読
                    </span>
                    <span th:unless="${handoff.readFlag == 1}"
                          class="badge badge-unread rounded-pill">
                      未読
                    </span>
                  </td>

                  <!-- 操作 -->
                  <td class="text-center">

                    <form th:if="${handoff.readFlag != 1}"
                          th:action="@{/handoff/{id}/read(id=${handoff.id})}"
                          method="post"
                          class="m-0 d-inline">
                      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                      <button type="submit" class="btn btn-sm btn-success">
                        既読にする
                      </button>
                    </form>

                    <span th:if="${handoff.readFlag == 1}"
                          class="badge badge-read rounded-pill">
                      既読済み
                    </span>

                  </td>

                </tr>

                <tr th:if="${#lists.isEmpty(handoffs)}">
                  <td colspan="6" class="text-center text-muted py-5">
                    まだ引き継ぎはありません
                  </td>
                </tr>

              </tbody>
            </table>
			<!-- forbidden modal -->
			<div class="modal fade" id="forbiddenModal" tabindex="-1" aria-hidden="true">
			  <div class="modal-dialog modal-dialog-centered">
			    <div class="modal-content" style="background:#151922; border:1px solid rgba(255,255,255,.08);">
			      <div class="modal-header border-0">
			        <h5 class="modal-title text-light">操作できません</h5>
			        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
			      </div>

			      <div class="modal-body text-light">
			        他のユーザーの投稿は編集できません。
			      </div>

			      <div class="modal-footer border-0">
			        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">
			          OK
			        </button>
			      </div>
			    </div>
			  </div>
			</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const params = new URLSearchParams(window.location.search);
    if (params.has("forbidden")) {
      const modalEl = document.getElementById("forbiddenModal");
      if (modalEl) {
        const modal = new bootstrap.Modal(modalEl);
        modal.show();

        // ついでにURLの ?forbidden を消して、リロードでまた出ないようにする（任意）
        params.delete("forbidden");
        const newUrl = window.location.pathname + (params.toString() ? "?" + params.toString() : "");
        history.replaceState(null, "", newUrl);
      }
    }
  });
</script>
</body>
</html>
